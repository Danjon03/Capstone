<!DOCTYPE html>
 <html lang="en">
 <head>
   <meta charset="UTF-8" />
   <title>Edit Asset Form Templates</title>
 
   <script src="../API_Functions/postRecords.js"></script>
 
   <style>
     body {
       font-family: Arial, sans-serif;
       background-color: #0d25dc;
       color: white;
       padding: 20px;
     }
     h2, h3 {
       margin-bottom: 10px;
     }
     label {
       display: block;
       margin-top: 10px;
     }
     input[type="text"], select {
       width: 100%;
       max-width: 400px;
       padding: 8px;
       margin-bottom: 10px;
     }
     button {
       max-width: 220px;
       padding: 10px;
       font-weight: bold;
       background-color: #007bff;
       border: none;
       color: white;
       cursor: pointer;
       margin-top: 5px;
       border-radius: 4px;
     }
     button:hover {
       background-color: #0056b3;
     }
     #deleteFormBtn {
       background-color: #dc3545;
     }
     #deleteFormBtn:hover {
       background-color: #a71d2a;
     }
     .field-entry {
       display: flex;
       gap: 10px;
       margin-bottom: 5px;
     }
     .field-entry input {
       flex: 1;
     }
     .field-entry button {
       background-color: #dc3545;
       padding: 5px 10px;
       font-size: 14px;
     }
   </style>
 </head>
 <body>
   <h2>Edit Asset Forms</h2>
 
   <label for="formSelector">Select Form to Edit:</label>
   <select id="formSelector">
     <option value="">-- Select a Form --</option>
   </select>
 
   <div id="editFormArea"></div>
 
   <script>
     let templates = {};
 
     async function getAllTemplates() {
       return await getTemplates(); // assumed external async function
     }
 
     function buildTemplateMap(templateArray) {
       const map = {};
       templateArray.forEach(template => {
         map[template._id] = template;
       });
       return map;
     }
 
     function populateFormSelector(templates) {
       const formSelector = document.getElementById("formSelector");
       formSelector.innerHTML = '<option value="">-- Select a Form --</option>';
       Object.values(templates).forEach(template => {
         const option = document.createElement("option");
         option.value = template._id;
         option.textContent = template.title;
         formSelector.appendChild(option);
       });
     }
 
     function addEditField(container, value = "") {
       const div = document.createElement("div");
       div.className = "field-entry";
 
       const input = document.createElement("input");
       input.type = "text";
       input.value = value;
       input.placeholder = "Field title";
 
       const delBtn = document.createElement("button");
       delBtn.textContent = "X";
       delBtn.onclick = () => div.remove();
 
       div.appendChild(input);
       div.appendChild(delBtn);
       container.appendChild(div);
     }
 
     function editForm(templateId) {
       const editArea = document.getElementById("editFormArea");
       const template = templates[templateId];
       editArea.innerHTML = `<h3>Editing: ${template.title}</h3>`;
 
       const fields = template?.fieldValues || [];
       const fieldList = document.createElement("div");
       fieldList.id = "editFields";
 
       fields.forEach((field) => addEditField(fieldList, field));
       editArea.appendChild(fieldList);
 
       const addFieldBtn = document.createElement("button");
       addFieldBtn.textContent = "Add Field";
       addFieldBtn.onclick = () => addEditField(fieldList);
       editArea.appendChild(addFieldBtn);
 
       const saveBtn = document.createElement("button");
       saveBtn.textContent = "Save Changes";
       saveBtn.onclick = () => {
         saveNewForm(); // reuse your centralized save logic
         location.reload();
       };
 
       const deleteBtn = document.createElement("button");
       deleteBtn.id = "deleteFormBtn";
       deleteBtn.textContent = "Delete This Form";
       deleteBtn.onclick = () => {
         if (confirm(`Are you sure you want to delete the "${template.title}" form?`)) {
           delete templates[templateId];
           localStorage.setItem("formTemplates", JSON.stringify(templates));
           alert("Form deleted.");
           location.reload();
         }
       };
 
       editArea.appendChild(saveBtn);
       editArea.appendChild(deleteBtn);
     }
 
     function addNewField() {
       const container = document.getElementById("editFields");
       if (container) {
         addEditField(container);
       }
     }
 
     function saveNewForm() {
       const title = document.querySelector("h3")?.textContent?.replace("Editing: ", "").trim();
       const fields = [...document.querySelectorAll("#editFields input")]
         .map(i => i.value.trim()).filter(Boolean);
       const id = document.getElementById("formSelector").value;
 
       if (!title || fields.length === 0 || !id) {
         alert("Please select a form and fill in at least one field.");
         return;
       }
 
       const newTemplate = {
         title,
         timestamp: new Date().toLocaleString(),
         userId: 0,
         fieldValues: fields
       };
 
       updateTemplate(id, newTemplate); // assumes globally defined function
     }
 
     window.onload = async () => {
       const rawTemplates = await getAllTemplates();
       templates = buildTemplateMap(rawTemplates);
       populateFormSelector(templates);
 
       document.getElementById("formSelector").addEventListener("change", function () {
         if (this.value) {
           editForm(this.value);
         } else {
           document.getElementById("editFormArea").innerHTML = "";
         }
       });
     };
   </script>
 </body>
 </html>